module.exports=[29141,(a,b,c)=>{b.exports=a.r(34059)},27190,a=>{"use strict";a.s(["default",()=>u],27190);var b=a.i(77893),c=a.i(67752),d=a.i(29141),e=a.i(83939),f=a.i(20369),g=a.i(48092),h=a.i(14697),i=a.i(78103),j=a.i(42641),k=c,l=a.i(50378);class m extends k.Component{getSnapshotBeforeUpdate(a){let b=this.props.childRef.current;if(b&&a.isPresent&&!this.props.isPresent){let a=b.offsetParent,c=(0,j.isHTMLElement)(a)&&a.offsetWidth||0,d=this.props.sizeRef.current;d.height=b.offsetHeight||0,d.width=b.offsetWidth||0,d.top=b.offsetTop,d.left=b.offsetLeft,d.right=c-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function n({children:a,isPresent:c,anchorX:d,root:e}){let f=(0,k.useId)(),g=(0,k.useRef)(null),h=(0,k.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:i}=(0,k.useContext)(l.MotionConfigContext);return(0,k.useInsertionEffect)(()=>{let{width:a,height:b,top:j,left:k,right:l}=h.current;if(c||!g.current||!a||!b)return;let m="left"===d?`left: ${k}`:`right: ${l}`;g.current.dataset.motionPopId=f;let n=document.createElement("style");i&&(n.nonce=i);let o=e??document.head;return o.appendChild(n),n.sheet&&n.sheet.insertRule(`
          [data-motion-pop-id="${f}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${b}px !important;
            ${m}px !important;
            top: ${j}px !important;
          }
        `),()=>{o.contains(n)&&o.removeChild(n)}},[c]),(0,b.jsx)(m,{isPresent:c,childRef:g,sizeRef:h,children:k.cloneElement(a,{ref:g})})}let o=({children:a,initial:d,isPresent:e,onExitComplete:f,custom:h,presenceAffectsLayout:j,mode:k,anchorX:l,root:m})=>{let o=(0,g.useConstant)(p),q=(0,c.useId)(),r=!0,s=(0,c.useMemo)(()=>(r=!1,{id:q,initial:d,isPresent:e,custom:h,onExitComplete:a=>{for(let b of(o.set(a,!0),o.values()))if(!b)return;f&&f()},register:a=>(o.set(a,!1),()=>o.delete(a))}),[e,o,f]);return j&&r&&(s={...s}),(0,c.useMemo)(()=>{o.forEach((a,b)=>o.set(b,!1))},[e]),c.useEffect(()=>{e||o.size||!f||f()},[e]),"popLayout"===k&&(a=(0,b.jsx)(n,{isPresent:e,anchorX:l,root:m,children:a})),(0,b.jsx)(i.PresenceContext.Provider,{value:s,children:a})};function p(){return new Map}var q=a.i(55606);let r=a=>a.key||"";function s(a){let b=[];return c.Children.forEach(a,a=>{(0,c.isValidElement)(a)&&b.push(a)}),b}let t=({children:a,custom:d,initial:e=!0,onExitComplete:i,presenceAffectsLayout:j=!0,mode:k="sync",propagate:l=!1,anchorX:m="left",root:n})=>{let[p,t]=(0,q.usePresence)(l),u=(0,c.useMemo)(()=>s(a),[a]),v=l&&!p?[]:u.map(r),w=(0,c.useRef)(!0),x=(0,c.useRef)(u),y=(0,g.useConstant)(()=>new Map),[z,A]=(0,c.useState)(u),[B,C]=(0,c.useState)(u);(0,h.useIsomorphicLayoutEffect)(()=>{w.current=!1,x.current=u;for(let a=0;a<B.length;a++){let b=r(B[a]);v.includes(b)?y.delete(b):!0!==y.get(b)&&y.set(b,!1)}},[B,v.length,v.join("-")]);let D=[];if(u!==z){let a=[...u];for(let b=0;b<B.length;b++){let c=B[b],d=r(c);v.includes(d)||(a.splice(b,0,c),D.push(c))}return"wait"===k&&D.length&&(a=D),C(s(a)),A(u),null}let{forceRender:E}=(0,c.useContext)(f.LayoutGroupContext);return(0,b.jsx)(b.Fragment,{children:B.map(a=>{let c=r(a),f=(!l||!!p)&&(u===B||v.includes(c));return(0,b.jsx)(o,{isPresent:f,initial:(!w.current||!!e)&&void 0,custom:d,presenceAffectsLayout:j,mode:k,root:n,onExitComplete:f?void 0:()=>{if(!y.has(c))return;y.set(c,!0);let a=!0;y.forEach(b=>{b||(a=!1)}),a&&(E?.(),C(x.current),l&&t?.(),i&&i())},anchorX:m,children:a},c)})})};function u(){let a=(0,d.useParams)(),f=a?.id,[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(null);async function k(){let a=await fetch(`/api/story/state?sessionId=${f}`),b=await a.json();a.ok&&h(b)}async function l(a){j(a);let b=await fetch("/api/story/continue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:f,choice:a})});await b.json(),j(null),k()}return(0,c.useEffect)(()=>{k()},[f]),(0,b.jsx)("div",{className:"px-4 sm:px-6 py-6 max-w-3xl mx-auto",children:g?(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsx)("div",{className:"w-full overflow-hidden rounded-2xl bg-white/70 dark:bg-white/5 border border-black/5 dark:border-white/10 shadow-sm",children:(0,b.jsxs)("picture",{children:[g.images.portrait&&(0,b.jsx)("source",{media:"(orientation: portrait)",srcSet:g.images.portrait}),g.images.landscape&&(0,b.jsx)("img",{src:g.images.landscape,alt:"Scene",className:"w-full h-auto block"})]})}),(0,b.jsx)(t,{mode:"wait",children:(0,b.jsx)(e.motion.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.25},className:"rounded-2xl p-5 bg-white/80 dark:bg-white/5 backdrop-blur border border-black/5 dark:border-white/10",children:(0,b.jsx)("p",{className:"leading-7",children:g.node.text})},g.node.id)}),(0,b.jsx)("div",{className:"grid gap-3 sm:grid-cols-3",children:g.node.choices.slice(0,3).map((a,c)=>(0,b.jsx)("button",{onClick:()=>l(a),className:"rounded-xl p-[2px] bg-gradient-to-br from-cyan-400/60 via-fuchsia-400/40 to-violet-500/60 hover:from-cyan-400 hover:to-violet-500 transition",disabled:!!i,children:(0,b.jsx)("div",{className:"rounded-[10px] bg-white/80 dark:bg-black/40 backdrop-blur-md py-3 px-4 text-sm text-center min-h-12 grid place-items-center",children:i===a?"…":a})},c))})]}):(0,b.jsx)("div",{className:"text-center opacity-70",children:"Loading…"})})}}];

//# sourceMappingURL=story_test_ai-cyoa_54efa5a9._.js.map