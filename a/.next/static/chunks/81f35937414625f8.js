(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70073,(e,t,n)=>{t.exports=e.r(90477)},75645,e=>{"use strict";e.s(["default",()=>v],75645);var t=e.i(37750),n=e.i(22809),i=e.i(70073),r=e.i(52368);e.i(51570);var o=e.i(21380),s=e.i(9332),a=e.i(5121),l=e.i(30138),c=e.i(26092),d=n,u=e.i(94118);class h extends d.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,n=(0,c.isHTMLElement)(e)&&e.offsetWidth||0,i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft,i.right=n-i.width-i.left}return null}componentDidUpdate(){}render(){return this.props.children}}function p(e){let{children:n,isPresent:i,anchorX:r,root:o}=e,s=(0,d.useId)(),a=(0,d.useRef)(null),l=(0,d.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,d.useContext)(u.MotionConfigContext);return(0,d.useInsertionEffect)(()=>{let{width:e,height:t,top:n,left:d,right:u}=l.current;if(i||!a.current||!e||!t)return;a.current.dataset.motionPopId=s;let h=document.createElement("style");c&&(h.nonce=c);let p=null!=o?o:document.head;return p.appendChild(h),h.sheet&&h.sheet.insertRule('\n          [data-motion-pop-id="'.concat(s,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat("left"===r?"left: ".concat(d):"right: ".concat(u),"px !important;\n            top: ").concat(n,"px !important;\n          }\n        ")),()=>{p.contains(h)&&p.removeChild(h)}},[i]),(0,t.jsx)(h,{isPresent:i,childRef:a,sizeRef:l,children:d.cloneElement(n,{ref:a})})}let f=e=>{let{children:i,initial:r,isPresent:o,onExitComplete:a,custom:c,presenceAffectsLayout:d,mode:u,anchorX:h,root:f}=e,x=(0,s.useConstant)(m),g=(0,n.useId)(),b=!0,y=(0,n.useMemo)(()=>(b=!1,{id:g,initial:r,isPresent:o,custom:c,onExitComplete:e=>{for(let t of(x.set(e,!0),x.values()))if(!t)return;a&&a()},register:e=>(x.set(e,!1),()=>x.delete(e))}),[o,x,a]);return d&&b&&(y={...y}),(0,n.useMemo)(()=>{x.forEach((e,t)=>x.set(t,!1))},[o]),n.useEffect(()=>{o||x.size||!a||a()},[o]),"popLayout"===u&&(i=(0,t.jsx)(p,{isPresent:o,anchorX:h,root:f,children:i})),(0,t.jsx)(l.PresenceContext.Provider,{value:y,children:i})};function m(){return new Map}var x=e.i(50634);let g=e=>e.key||"";function b(e){let t=[];return n.Children.forEach(e,e=>{(0,n.isValidElement)(e)&&t.push(e)}),t}let y=e=>{let{children:i,custom:r,initial:l=!0,onExitComplete:c,presenceAffectsLayout:d=!0,mode:u="sync",propagate:h=!1,anchorX:p="left",root:m}=e,[y,v]=(0,x.usePresence)(h),w=(0,n.useMemo)(()=>b(i),[i]),j=h&&!y?[]:w.map(g),C=(0,n.useRef)(!0),k=(0,n.useRef)(w),P=(0,s.useConstant)(()=>new Map),[E,N]=(0,n.useState)(w),[R,S]=(0,n.useState)(w);(0,a.useIsomorphicLayoutEffect)(()=>{C.current=!1,k.current=w;for(let e=0;e<R.length;e++){let t=g(R[e]);j.includes(t)?P.delete(t):!0!==P.get(t)&&P.set(t,!1)}},[R,j.length,j.join("-")]);let T=[];if(w!==E){let e=[...w];for(let t=0;t<R.length;t++){let n=R[t],i=g(n);j.includes(i)||(e.splice(t,0,n),T.push(n))}return"wait"===u&&T.length&&(e=T),S(b(e)),N(w),null}let{forceRender:L}=(0,n.useContext)(o.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:R.map(e=>{let n=g(e),i=(!h||!!y)&&(w===R||j.includes(n));return(0,t.jsx)(f,{isPresent:i,initial:(!C.current||!!l)&&void 0,custom:r,presenceAffectsLayout:d,mode:u,root:m,onExitComplete:i?void 0:()=>{if(!P.has(n))return;P.set(n,!0);let e=!0;P.forEach(t=>{t||(e=!1)}),e&&(null==L||L(),S(k.current),h&&(null==v||v()),c&&c())},anchorX:p,children:e},n)})})};function v(){let e=(0,i.useParams)(),o=null==e?void 0:e.id,[s,a]=(0,n.useState)(null),[l,c]=(0,n.useState)(null);async function d(){let e=await fetch("/api/story/state?sessionId=".concat(o)),t=await e.json();e.ok&&a(t)}async function u(e){c(e);let t=await fetch("/api/story/continue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:o,choice:e})});await t.json(),c(null),d()}return(0,n.useEffect)(()=>{d()},[o]),(0,t.jsx)("div",{className:"px-4 sm:px-6 py-6 max-w-3xl mx-auto",children:s?(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)("div",{className:"w-full overflow-hidden rounded-2xl bg-white/70 dark:bg-white/5 border border-black/5 dark:border-white/10 shadow-sm",children:(0,t.jsxs)("picture",{children:[s.images.portrait&&(0,t.jsx)("source",{media:"(orientation: portrait)",srcSet:s.images.portrait}),s.images.landscape&&(0,t.jsx)("img",{src:s.images.landscape,alt:"Scene",className:"w-full h-auto block"})]})}),(0,t.jsx)(y,{mode:"wait",children:(0,t.jsx)(r.motion.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.25},className:"rounded-2xl p-5 bg-white/80 dark:bg-white/5 backdrop-blur border border-black/5 dark:border-white/10",children:(0,t.jsx)("p",{className:"leading-7",children:s.node.text})},s.node.id)}),(0,t.jsx)("div",{className:"grid gap-3 sm:grid-cols-3",children:s.node.choices.slice(0,3).map((e,n)=>(0,t.jsx)("button",{onClick:()=>u(e),className:"rounded-xl p-[2px] bg-gradient-to-br from-cyan-400/60 via-fuchsia-400/40 to-violet-500/60 hover:from-cyan-400 hover:to-violet-500 transition",disabled:!!l,children:(0,t.jsx)("div",{className:"rounded-[10px] bg-white/80 dark:bg-black/40 backdrop-blur-md py-3 px-4 text-sm text-center min-h-12 grid place-items-center",children:l===e?"…":e})},n))})]}):(0,t.jsx)("div",{className:"text-center opacity-70",children:"Loading…"})})}}]);